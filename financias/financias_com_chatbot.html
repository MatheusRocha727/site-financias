<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Finanças Residenciais</title>

  <!-- Bootstrap geral do site -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

  <!-- SEU CSS DO SITE DE FINANÇAS -->
  <link rel="stylesheet" href="style_save2.css">

  <!-- CSS DO CHATBOT (copiado do seu HTML de agente) -->
  <style>
    :root{
      --brand-primary:#03223f;   /* navy */
      --brand-accent:#9dc34a;    /* green */
      --ink:#0e1a1e;             /* texto */
      --muted:#64707a;           /* apoio */
      --surface:#ffffff;         /* card */
      --bg:#f6f8f7;              /* page */
    }

    /* NÃO mexe no html/body do seu layout se já tiver */
    html,body{
      height:100%;
      background:var(--bg);
      color:var(--ink);
      margin:0;
      padding:0;
    }

    /* ==== WIDGET FIXO NO CANTO DIREITO ==== */
    #chat-widget {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 320px;
      height: 450px;

      background: var(--surface);
      border: 1px solid #e3e7e5;
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(3,34,63,.25);
      z-index: 9999;

      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: height 0.2s ease;
    }

    /* Estado minimizado */
    #chat-widget.collapsed {
      height: 64px; /* só cabeçalho */
    }
    #chat-widget.collapsed .body,
    #chat-widget.collapsed .footer {
      display: none;
    }

    /* Shell do chat */
    .shell{
      width:100%;
      height:100%;
      background:var(--surface);
      border-radius:18px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    .hero{
      display:flex;
      align-items:center;
      gap:16px;
      padding:12px 12px 8px 12px;
      border-bottom:1px solid #eef1f0;
    }
    .hero .avatar{
      width:40px; height:40px; border-radius:50%;
      display:grid; place-items:center;
      background:#eef6ea; border:2px solid var(--brand-accent);
      overflow:hidden;
      flex-shrink:0;
    }
    .hero img{ width:100%; height:100%; object-fit:cover; }

    .hero .title{
      font-weight:700; color:var(--brand-primary); margin:0;
      font-size:0.95rem;
    }
    .hero .subtitle{
      margin:2px 0 0 0; color:var(--muted); font-size:.75rem;
    }

    .body{
      padding:8px 12px 0 12px;
      flex:1 1 auto;
      min-height:0;
    }

    .chat{
      height:100%;
      max-height:280px;
      overflow:auto;
      padding:4px 0 8px 0;
    }

    .msg{
      display:flex; gap:8px; margin-bottom:10px;
      font-size:.85rem;
    }
    .msg .bubble{
      padding:8px 10px; border-radius:14px;
      background:#f2f6f3; border:1px solid #e3eee5;
      max-width:85%;
      white-space:pre-wrap;
    }
    .msg.me .bubble{
      background:#e7f2d3; border-color:#d4e7b3;
    }
    .msg .who{
      width:24px; height:24px; flex:0 0 24px;
      border-radius:50%; background:#eaf4e0; display:grid; place-items:center;
      border:1px solid #d9ead1; font-size:.65rem; color:#3a5f1d;
    }

    .footer{
      padding:8px 12px 12px 12px; border-top:1px solid #eef1f0;
      background:linear-gradient(to top, #fafcfb, #ffffff);
    }

    .btn-primary{
      --bs-btn-bg:var(--brand-primary);
      --bs-btn-border-color:var(--brand-primary);
      --bs-btn-hover-bg:#021c34;
      --bs-btn-hover-border-color:#021c34;
    }

    .small-muted{ color:var(--muted); font-size:.75rem; }

    /* Botão de minimizar/maximizar */
    #toggle-window {
      border-radius:999px;
      padding:2px 8px;
      font-size:0.75rem;
      line-height:1;
    }
  </style>
</head>
<body>

  <!-- ================== SEU SITE DE FINANÇAS ================== -->
  <header class="p-3 bg-dark text-white">
    <div class="container">
      <h1 class="h4 mb-0">Finanças Residenciais</h1>
    </div>
  </header>

  <main class="container my-4">
    <!-- Aqui entra TODO o conteúdo do seu app de finanças:
         menus, cards, receitas, despesas, gráficos etc. -->
    <p>Seu conteúdo de Finanças vai aqui…</p>
  </main>
  <!-- ================== FIM DO SEU SITE ================== -->


  <!-- ================== CHATBOT FIXO NO CANTO DIREITO ================== -->
  <div id="chat-widget">
    <section class="shell" role="region" aria-label="FINC">
      <!-- Header / Hero -->
      <div class="hero">
        <div class="avatar">
          <img src="./gptequinho_Filho_Do_Leo_2.png" alt="Agente de Locução">
        </div>
        <div class="flex-grow-1">
          <h1 class="title">Mini Léogpteco</h1>
          <p class="subtitle">Seu assistente financeiro.</p>
        </div>
        <button id="toggle-window" class="btn btn-sm btn-light ms-auto" title="Minimizar/Maximizar">–</button>
      </div>

      <!-- Corpo / Mensagens -->
      <div class="body">
        <div id="chat" class="chat" aria-live="polite" aria-atomic="false">
          <div class="msg">
            <div class="who">IA</div>
            <div class="bubble">Estou aqui para tirar suas dúvidas, por onde começamos?</div>
          </div>
        </div>
      </div>

      <!-- Footer / Input -->
      <div class="footer">
        <div class="input-group input-group-sm">
          <input id="pergunta" type="text" class="form-control" placeholder="Digite aqui sua pergunta">
          <button id="btn" class="btn btn-primary">Enviar</button>
        </div>
        <div id="status" class="small-muted mt-1"></div>
      </div>
    </section>
  </div>
  <!-- ================== FIM DO CHATBOT ================== -->


  <!-- JS do seu site de finanças -->
  <script src="script_save2.js"></script>

  <!-- JS do chatbot (copiado do seu HTML) -->
  <script>
    // Alavancas de UX
    const chatEl = document.getElementById('chat');
    const inputEl = document.getElementById('pergunta');
    const btnEl = document.getElementById('btn');
    const statusEl = document.getElementById('status');

    // Core de interação
    btnEl.addEventListener('click', onSubmit);
    inputEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') onSubmit(); });

    async function onSubmit(){
      const text = inputEl.value.trim();
      if(!text){ inputEl.focus(); return; }

      pushMessage('me', text);
      inputEl.value = '';
      lock(true, 'Processando…');

      try{
        const out = await callPoeAPI(text);
        pushMessage('ai', out || 'Sem conteúdo retornado.');
      }catch(err){
        console.error(err);
        pushMessage('ai', 'Falha na solicitação. Consulte o console.');
      }finally{
        lock(false, '');
      }
    }

    function pushMessage(who, text){
      const wrap = document.createElement('div');
      wrap.className = 'msg' + (who==='me' ? ' me' : '');
      wrap.innerHTML = `
        <div class="who">${who==='me'?'Você':'IA'}</div>
        <div class="bubble"></div>
      `;
      wrap.querySelector('.bubble').textContent = text;
      chatEl.appendChild(wrap);
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    function lock(state, msg=''){
      btnEl.disabled = state;
      inputEl.disabled = state;
      statusEl.textContent = msg;
    }

    // === Cliente de API (POC) ===
    async function callPoeAPI(prompt, model='GPT-4o'){
      const POE_API_KEY = 'vj2kWqra9hpkDV3Oy-u-P_ShLVA4JiKY7OTOPuuzwDY'; // NÃO usar em produção no front.
      const POE_API_URL = 'https://api.poe.com/v1/chat/completions';

      const resp = await fetch(POE_API_URL, {
        method:'POST',
        headers:{
          'Content-Type':'application/json',
          'Authorization':`Bearer ${POE_API_KEY}`
        },
        body: JSON.stringify({
          model,
          messages:[{ role:'user', content: prompt }]
        })
      });

      if(!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const data = await resp.json();
      return data?.choices?.[0]?.message?.content ?? '';
    }

    // === Minimize / Maximize da janela ===
    const widget = document.getElementById('chat-widget');
    const toggleWindow = document.getElementById('toggle-window');

    toggleWindow.addEventListener('click', () => {
      widget.classList.toggle('collapsed');

      // Ajusta o símbolo do botão
      if (widget.classList.contains('collapsed')) {
        toggleWindow.textContent = '▲'; // maximizar
      } else {
        toggleWindow.textContent = '–'; // minimizar
      }
    });
  </script>
</body>
</html>
